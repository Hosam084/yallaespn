<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>مباريات كرة القدم</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family:'Cairo',sans-serif; background:#f0f2f5; margin:0; padding:20px; text-align:right; }
    #matches-container { width:95%; max-width:720px; margin:auto; }
    #matches-tabs { display:flex; justify-content:center; gap:15px; margin-bottom:20px; }
    .tab-btn { flex:1; max-width:150px; background:#1976D2; color:#fff; border:none; padding:12px 0; border-radius:16px; cursor:pointer; font-weight:bold; transition:0.2s; }
    .tab-btn.active { background:#4caf50; }
    table { width:100%; border-collapse:separate; border-spacing:0 10px; margin-bottom:20px; }
    tbody.match-card { background:#fff; border-radius:12px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
    .championship-row td { text-align:left; font-size:12px; font-weight:bold; color:#757575; padding:6px 12px; border-bottom:1px solid #eee; }
    td { text-align:center; font-size:14px; padding:8px 6px; }
    .team-name { font-weight:bold; display:block; }
    .match-time, .score { font-size:13px; font-weight:bold; color:#1976D2; }
    .status-message { text-align:center; padding:40px 20px; font-size:16px; color:#555; background:#fff; border-radius:12px; }
  </style>
</head>
<body>
  <div id="matches-container" style="display:none;">
    <div id="matches-tabs">
      <button class="tab-btn" data-day="yesterday">أمس</button>
      <button class="tab-btn" data-day="today">اليوم</button>
      <button class="tab-btn" data-day="tomorrow">غدًا</button>
    </div>
    <div id="matches-table"></div>
  </div>

<script>
let allMatches = { yesterday: [], today: [], tomorrow: [] };

function parseDate(str) { return new Date(str); }

function filterMatches(matches) {
  const today = new Date(); today.setHours(0,0,0,0);
  const yesterday = new Date(today); yesterday.setDate(today.getDate()-1);
  const tomorrow = new Date(today); tomorrow.setDate(today.getDate()+1);

  let grouped = { yesterday: [], today: [], tomorrow: [] };
  matches.forEach(m => {
    const d = parseDate(m.date); d.setHours(0,0,0,0);
    if(d.getTime() === today.getTime()) grouped.today.push(m);
    else if(d.getTime() === yesterday.getTime()) grouped.yesterday.push(m);
    else if(d.getTime() === tomorrow.getTime()) grouped.tomorrow.push(m);
  });
  return grouped;
}

function generateTable(matches, day){
  if(matches.length===0) return '<p class="status-message">لا توجد مباريات لهذا اليوم</p>';
  let html = '<table>'; let currentChampionship='';
  matches.forEach(m=>{
    if(m.championship !== currentChampionship){
      currentChampionship = m.championship;
      html += `<tbody class="match-card"><tr class="championship-row"><td colspan="3">${currentChampionship}</td></tr>`;
    }
    html += `<tr><td>${m.teamA}</td><td>${m.time}<br>${m.score}</td><td>${m.teamB}</td></tr>`;
  });
  html += '</table>';
  return html;
}

function showMatches(day){
  document.getElementById('matches-table').innerHTML = generateTable(allMatches[day], day);
}

async function loadMatches(){
  try{
    const res = await fetch('https://site.api.espn.com/apis/site/v2/sports/soccer/eng.1/scoreboard');
    const data = await res.json();

    let matches = data.events.map(event => {
      const championship = event.competitions[0].league.name || "عام";
      const teamA = event.competitions[0].competitors[0].team.shortDisplayName || "—";
      const teamB = event.competitions[0].competitors[1].team.shortDisplayName || "—";
      const date = new Date(event.date).toISOString().split('T')[0];
      const time = new Date(event.date).toLocaleTimeString('ar-EG', { hour:'2-digit', minute:'2-digit' });
      const score = event.competitions[0].competitors.map(c=>c.score).join(' - ') || "--";
      return { championship, teamA, teamB, date, time, score };
    });

    allMatches = filterMatches(matches);
    document.getElementById('matches-container').style.display = 'block';
    showMatches('today');
  } catch(err){
    document.getElementById('matches-table').innerHTML = '<p class="status-message">خطأ في تحميل المباريات</p>';
    console.error(err);
  }
}

// Tabs control
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    showMatches(btn.dataset.day);
  });
});
document.querySelector('.tab-btn[data-day="today"]').classList.add('active');

loadMatches();
setInterval(loadMatches,60000);
</script>
</body>
</html>
